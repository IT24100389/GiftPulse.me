<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Christmas Hub - Inspired by Apple Design</title>
    <!-- Favicon / Tab Icon added here (White sparkle on deep red background) -->
    <link rel="icon" type="image/png" href="https://placehold.co/32x32/c0392b/ffffff?text=%E2%9C%A8">
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #c0392b; /* Deep Christmas Red */
            --secondary: #27ae60; /* Evergreen */
            --background: #f8f8f8;
            --text-dark: #1c1c1c;
            --text-light: #ffffff;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background);
            color: var(--text-dark);
            min-height: 100vh;
        }
        /* Custom Class for 'Apple-like' Card Style */
        .apple-card {
            background-color: var(--text-light);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
            transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94), box-shadow 0.3s;
            border: 1px solid #e5e5e5;
        }
        .apple-card:hover {
            transform: translateY(-4px) scale(1.01);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.05);
        }
        /* Page Transition Animation */
        .page-content {
            animation: fadeInSlide 0.7s ease-out;
        }
        @keyframes fadeInSlide {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* --- BUBBLE BACKGROUND ANIMATION STYLES --- */
        #bubble-wrapper {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -10; /* Put behind all content */
            pointer-events: none; /* Prevent blocking clicks */
            overflow: hidden;
        }

        .bubble {
            position: absolute;
            bottom: -100px; /* Start below the viewport */
            background-color: rgba(255, 255, 255, 0.15); /* Very light, subtle white */
            border-radius: 50%;
            /* Subtle shadow to give depth */
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.7);
        }

        /* Animation Keyframes: rise slowly and fade out */
        @keyframes bubble-rise {
            0% {
                opacity: 0.15;
                transform: translateY(0);
            }
            100% {
                opacity: 0;
                /* Move 100vh up, exiting the top of the screen */
                transform: translateY(-100vh) translateX(50px);
            }
        }
    </style>
</head>
<body class="antialiased">

    <!-- BUBBLE BACKGROUND CONTAINER -->
    <div id="bubble-wrapper"></div>
    <!-- END BUBBLE BACKGROUND CONTAINER -->

    <!-- Navigation Bar -->
    <header class="sticky top-0 z-50 bg-white/90 backdrop-blur-md shadow-sm border-b border-gray-100">
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <!-- Logo/Title -->
                <div class="flex items-center">
                    <span class="text-2xl font-black tracking-tighter text-gray-900 flex items-center">
                        <i data-lucide="sparkles" class="w-6 h-6 mr-2 text-[var(--primary)]"></i>
                        Christmas Hub
                    </span>
                </div>
                <!-- Desktop Navigation Links -->
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <button onclick="navigate('home')" class="nav-link text-sm font-medium hover:text-[var(--primary)] transition-colors active-link" data-page="home">
                            Home
                        </button>
                        <button onclick="navigate('gifts')" class="nav-link text-sm font-medium hover:text-[var(--primary)] transition-colors" data-page="gifts">
                            Gifts
                        </button>
                        <button onclick="navigate('wishes')" class="nav-link text-sm font-medium hover:text-[var(--primary)] transition-colors" data-page="wishes">
                            Wishes
                        </button>
                        <button onclick="navigate('recipes')" class="nav-link text-sm font-medium hover:text-[var(--primary)] transition-colors" data-page="recipes">
                            Recipes
                        </button>
                        <button onclick="navigate('discounts')" class="nav-link text-sm font-medium hover:text-[var(--primary)] transition-colors" data-page="discounts">
                            Discount Values
                        </button>
                    </div>
                </div>
                <!-- Mobile Menu Button -->
                <div class="md:hidden">
                    <button id="mobile-menu-button" class="p-2 rounded-md text-gray-700 hover:bg-gray-100 transition-colors">
                        <i data-lucide="menu" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
        </nav>

        <!-- Mobile Menu (Hidden by default) -->
        <div id="mobile-menu" class="md:hidden hidden bg-white border-t border-gray-100">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3 flex flex-col">
                <button onclick="navigate('home')" class="mobile-nav-link block px-3 py-2 rounded-md text-base font-medium hover:bg-gray-50 active-mobile-link" data-page="home">Home</button>
                <button onclick="navigate('gifts')" class="mobile-nav-link block px-3 py-2 rounded-md text-base font-medium hover:bg-gray-50" data-page="gifts">Gifts</button>
                <button onclick="navigate('wishes')" class="mobile-nav-link block px-3 py-2 rounded-md text-base font-medium hover:bg-gray-50" data-page="wishes">Wishes</button>
                <button onclick="navigate('recipes')" class="mobile-nav-link block px-3 py-2 rounded-md text-base font-medium hover:bg-gray-50" data-page="recipes">Recipes</button>
                <button onclick="navigate('discounts')" class="mobile-nav-link block px-3 py-2 rounded-md text-base font-medium hover:bg-gray-50" data-page="discounts">Discount Values</button>
            </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <main id="content-container" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
        <!-- Content will be injected here by JavaScript -->
    </main>

    <!-- Footer -->
    <footer class="mt-20 border-t border-gray-200 bg-white">
        <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8 text-center text-gray-500 text-sm">
            <p>&copy; 2024 Christmas Hub. All rights reserved. | Inspired by clean, fresh design.</p>
        </div>
    </footer>


    <script type="module">
        // --- GEMINI API Configuration ---
        const apiKey = ""; // API Key will be handled by the execution environment
        const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

        // --- MOCK DATA (For Gifts, Wishes, Discounts) ---
        const giftCategories = ['Shoes', 'Decorations', 'Cards', 'Shirts', 'Caps', 'Tech', 'Books', 'Jewelry', 'Experience'];
        const mockGifts = [
            { id: 1, name: 'The New Silent Headphones', category: 'Tech', price: '$499', description: 'Ultimate noise cancellation and spatial audio.', link: 'https://affiliate.link/tech1', image: 'https://placehold.co/400x300/e0e0e0/333?text=Headphones' },
            { id: 2, name: 'Cozy Wool Cardigan', category: 'Shirts', price: '$129', description: 'Luxurious cashmere blend for winter warmth.', link: 'https://affiliate.link/shirt1', image: 'https://placehold.co/400x300/d5e6e6/333?text=Sweater' },
            { id: 3, name: 'Minimalist Wreath', category: 'Decorations', price: '$85', description: 'Handcrafted steel and LED light wreath.', link: 'https://affiliate.link/decor1', image: 'https://placehold.co/400x300/c7a7a7/333?text=Wreath' },
            { id: 4, name: 'Premium Leather Boots', category: 'Shoes', price: '$220', description: 'Waterproof and stylish for any winter journey.', link: 'https://affiliate.link/shoe1', image: 'https://placehold.co/400x300/a3c4f3/333?text=Boots' },
            { id: 5, name: 'Personalized Greeting Set', category: 'Cards', price: '$35', description: 'A set of 10 engraved holiday cards.', link: 'https://affiliate.link/card1', image: 'https://placehold.co/400x300/e9d5ff/333?text=Cards' },
            { id: 6, name: 'VR Fitness Bundle', category: 'Gaming', price: '$349', description: 'A new way to get active and entertained.', link: 'https://affiliate.link/gaming1', image: 'https://placehold.co/400x300/b3c5e8/333?text=VR+Kit' },
            { id: 7, name: 'Crystal Decanter Set', category: 'Home', price: '$150', description: 'Elegant glassware for the holiday dinner table.', link: 'https://affiliate.link/home1', image: 'https://placehold.co/400x300/d1e7c5/333?text=Decanter' },
            { id: 8, name: 'Adventure Backpack', category: 'Bags', price: '$95', description: 'Durable and spacious for travel and hikes.', link: 'https://affiliate.link/bag1', image: 'https://placehold.co/400x300/f3e8c5/333?text=Backpack' },
        ];
        const mockWishes = [
            { id: 1, recipient: 'Mom', wish: "To the woman who gave me everything: May your Christmas be filled with the same joy and endless light you bring to my life. I love you." },
            { id: 2, recipient: 'Dad', wish: "Wishing the best role model a Christmas filled with peace, quiet, and great food. Thanks for always teaching me how to be strong." },
            { id: 3, recipient: 'Brother', wish: "Happy Holidays, bro! Ready for a Christmas of chilling, great video games, and maybe a little too much eggnog? Have a blast!" },
            { id: 4, recipient: 'Sister', wish: "To my amazing sister, wishing you a holiday season as beautiful and vibrant as you are. May your new year be the best one yet." },
            { id: 5, recipient: 'Friend', wish: "Happy Holidays! Thanks for being the best friend a person could ask for. Hope your day is filled with laughter and good company. Cheers to the new year!" },
            { id: 6, recipient: 'Grandparents', wish: "To my wonderful grandparents, thank you for the stories and the warmth. May your holiday be cozy and bright." },
        
            // New wishes for Mom
            { id: 7, recipient: 'Mom', wish: "Mom, your endless love makes every Christmas magical. Wishing you a season filled with peace, warmth, and the joy you've always given us." },
            { id: 8, recipient: 'Mom', wish: "To the heart of our family, Mom: May this Christmas bring you relaxation, beautiful moments, and all the happiness you deserve." },
            { id: 9, recipient: 'Mom', wish: "Mom, thank you for making holidays special. Wishing you a Christmas overflowing with love, laughter, and cherished memories." },
            { id: 10, recipient: 'Mom', wish: "Dearest Mom, your strength inspires us daily. May your Christmas be as wonderful and nurturing as you are to us." },
            { id: 11, recipient: 'Mom', wish: "Mom, you're our guiding star. Wishing you a merry Christmas with health, happiness, and time to enjoy the little things." },
            { id: 12, recipient: 'Mom', wish: "To my amazing Mom: This Christmas, may you feel the same comfort and joy you bring to everyone around you." },
            { id: 13, recipient: 'Mom', wish: "Mom, your hugs are the best gift. Wishing you a holiday season full of serenity, love, and beautiful surprises." },
            { id: 14, recipient: 'Mom', wish: "Thank you, Mom, for all the traditions. May your Christmas be bright, peaceful, and filled with family warmth." },
            { id: 15, recipient: 'Mom', wish: "Mom, you're irreplaceable. Wishing you a Christmas that's as sweet and loving as your presence in our lives." },
            { id: 16, recipient: 'Mom', wish: "To Mom, with all my love: May this Christmas wrap you in joy, good health, and the magic of the season." },
            { id: 17, recipient: 'Mom', wish: "Mom, your wisdom lights our path. Wishing you a festive Christmas with rest, laughter, and endless blessings." },
            { id: 18, recipient: 'Mom', wish: "Dearest Mom, thank you for everything. May your holiday be merry, bright, and full of heartfelt moments." },
            { id: 19, recipient: 'Mom', wish: "Mom, you're the reason for our smiles. Wishing you a Christmas season of peace, love, and wonderful memories." },
            { id: 20, recipient: 'Mom', wish: "To the best Mom ever: May this Christmas bring you the relaxation and joy you've earned a thousand times over." },
            { id: 21, recipient: 'Mom', wish: "Mom, your care is unmatched. Wishing you a warm Christmas filled with family, fun, and all your favorite things." },
            { id: 22, recipient: 'Mom', wish: "Thank you, Mom, for your unwavering support. May your Christmas be as beautiful and kind as you are." },
            { id: 23, recipient: 'Mom', wish: "Mom, you're our family's anchor. Wishing you a holiday full of happiness, health, and treasured times together." },
            { id: 24, recipient: 'Mom', wish: "To Mom, who makes everything better: May this Christmas shower you with love, peace, and joyful surprises." },
            { id: 25, recipient: 'Mom', wish: "Mom, your love is the greatest gift. Wishing you a merry Christmas with serenity and all the warmth you give." },
            { id: 26, recipient: 'Mom', wish: "Dearest Mom, thank you for being you. May your Christmas be filled with magic, laughter, and boundless joy." },
        
            // New wishes for Dad
            { id: 27, recipient: 'Dad', wish: "Dad, your guidance shapes us all. Wishing you a Christmas full of peace, adventure, and the rest you deserve." },
            { id: 28, recipient: 'Dad', wish: "To the best Dad: May this holiday season bring you joy, good health, and moments to relax with loved ones." },
            { id: 29, recipient: 'Dad', wish: "Dad, thank you for your strength. Wishing you a merry Christmas with laughter, warmth, and family fun." },
            { id: 30, recipient: 'Dad', wish: "Dearest Dad, you're our hero. May your Christmas be as steadfast and wonderful as you are to us." },
            { id: 31, recipient: 'Dad', wish: "Dad, your stories make holidays bright. Wishing you a season of happiness, peace, and cherished memories." },
            { id: 32, recipient: 'Dad', wish: "To my incredible Dad: This Christmas, may you enjoy the quiet joys and love you've always provided." },
            { id: 33, recipient: 'Dad', wish: "Dad, your wisdom is priceless. Wishing you a festive Christmas with health, laughter, and great times." },
            { id: 34, recipient: 'Dad', wish: "Thank you, Dad, for all the lessons. May your holiday be merry, bright, and full of relaxation." },
            { id: 35, recipient: 'Dad', wish: "Dad, you're one of a kind. Wishing you a Christmas that's as strong and loving as your spirit." },
            { id: 36, recipient: 'Dad', wish: "To Dad, with gratitude: May this Christmas wrap you in joy, adventure, and family warmth." },
            { id: 37, recipient: 'Dad', wish: "Dad, your support means everything. Wishing you a peaceful Christmas with rest and happy moments." },
            { id: 38, recipient: 'Dad', wish: "Dearest Dad, thank you for being there. May your holiday be filled with cheer and good times." },
            { id: 39, recipient: 'Dad', wish: "Dad, you're the foundation of our family. Wishing you a Christmas of peace, love, and fun." },
            { id: 40, recipient: 'Dad', wish: "To the greatest Dad: May this Christmas bring you the joy and relaxation you've earned." },
            { id: 41, recipient: 'Dad', wish: "Dad, your humor lights up our lives. Wishing you a warm holiday with family and laughter." },
            { id: 42, recipient: 'Dad', wish: "Thank you, Dad, for your endless care. May your Christmas be as reliable and kind as you." },
            { id: 43, recipient: 'Dad', wish: "Dad, you're our rock. Wishing you a holiday full of happiness, health, and special memories." },
            { id: 44, recipient: 'Dad', wish: "To Dad, who fixes everything: May this Christmas shower you with love and peaceful days." },
            { id: 45, recipient: 'Dad', wish: "Dad, your love is unwavering. Wishing you a merry Christmas with serenity and joy." },
            { id: 46, recipient: 'Dad', wish: "Dearest Dad, thank you for all. May your Christmas be magical, bright, and full of blessings." },
        
            // New wishes for Brother
            { id: 47, recipient: 'Brother', wish: "Brother, you're my built-in best friend. Wishing you a Christmas packed with fun, games, and great vibes." },
            { id: 48, recipient: 'Brother', wish: "To my awesome Brother: May this holiday bring you adventure, laughter, and all the joy you deserve." },
            { id: 49, recipient: 'Brother', wish: "Brother, thanks for the memories. Wishing you a merry Christmas with excitement and family cheer." },
            { id: 50, recipient: 'Brother', wish: "Dearest Brother, you're always there. May your Christmas be as cool and fun as you are." },
            { id: 51, recipient: 'Brother', wish: "Brother, your energy is contagious. Wishing you a season of happiness, games, and good times." },
            { id: 52, recipient: 'Brother', wish: "To my Brother: This Christmas, may you have epic moments, laughs, and holiday magic." },
            { id: 53, recipient: 'Brother', wish: "Brother, you're irreplaceable. Wishing you a festive Christmas with adventure and warmth." },
            { id: 54, recipient: 'Brother', wish: "Thank you, Brother, for the fun. May your holiday be bright, exciting, and full of joy." },
            { id: 55, recipient: 'Brother', wish: "Brother, you're the best sibling. Wishing you a Christmas that's as awesome as our bond." },
            { id: 56, recipient: 'Brother', wish: "To Brother, with love: May this Christmas wrap you in fun, games, and happy surprises." },
            { id: 57, recipient: 'Brother', wish: "Brother, your support rocks. Wishing you a peaceful Christmas with laughs and good vibes." },
            { id: 58, recipient: 'Brother', wish: "Dearest Brother, thank you for everything. May your holiday be merry and adventurous." },
            { id: 59, recipient: 'Brother', wish: "Brother, you're family and friend. Wishing you a Christmas of excitement and warmth." },
            { id: 60, recipient: 'Brother', wish: "To the coolest Brother: May this Christmas bring you joy, fun, and epic memories." },
            { id: 61, recipient: 'Brother', wish: "Brother, your humor shines. Wishing you a warm holiday with games and laughter." },
            { id: 62, recipient: 'Brother', wish: "Thank you, Brother, for being you. May your Christmas be as fun and kind as you." },
            { id: 63, recipient: 'Brother', wish: "Brother, you're my ally. Wishing you a holiday full of happiness and adventures." },
            { id: 64, recipient: 'Brother', wish: "To Brother, who shares it all: May this Christmas shower you with joy and fun." },
            { id: 65, recipient: 'Brother', wish: "Brother, your bond is strong. Wishing you a merry Christmas with excitement." },
            { id: 66, recipient: 'Brother', wish: "Dearest Brother, thanks for the laughs. May your Christmas be magical and bright." },
        
            // New wishes for Sister
            { id: 67, recipient: 'Sister', wish: "Sister, you're my confidante. Wishing you a Christmas filled with beauty, joy, and sparkling moments." },
            { id: 68, recipient: 'Sister', wish: "To my wonderful Sister: May this holiday bring you happiness, laughter, and all things bright." },
            { id: 69, recipient: 'Sister', wish: "Sister, thanks for the support. Wishing you a merry Christmas with warmth and family love." },
            { id: 70, recipient: 'Sister', wish: "Dearest Sister, you're inspiring. May your Christmas be as vibrant and kind as you." },
            { id: 71, recipient: 'Sister', wish: "Sister, your grace shines through. Wishing you a season of peace, fun, and cherished times." },
            { id: 72, recipient: 'Sister', wish: "To my Sister: This Christmas, may you feel the magic, love, and holiday cheer." },
            { id: 73, recipient: 'Sister', wish: "Sister, you're one of a kind. Wishing you a festive Christmas with joy and warmth." },
            { id: 74, recipient: 'Sister', wish: "Thank you, Sister, for the bond. May your holiday be bright, beautiful, and full of laughs." },
            { id: 75, recipient: 'Sister', wish: "Sister, you're the best. Wishing you a Christmas that's as sweet and loving as you." },
            { id: 76, recipient: 'Sister', wish: "To Sister, with all my heart: May this Christmas wrap you in happiness and surprises." },
            { id: 77, recipient: 'Sister', wish: "Sister, your strength amazes. Wishing you a peaceful Christmas with love and fun." },
            { id: 78, recipient: 'Sister', wish: "Dearest Sister, thank you always. May your holiday be merry and vibrant." },
            { id: 79, recipient: 'Sister', wish: "Sister, you're family forever. Wishing you a Christmas of joy and beautiful memories." },
            { id: 80, recipient: 'Sister', wish: "To the greatest Sister: May this Christmas bring you serenity and sparkling joy." },
            { id: 81, recipient: 'Sister', wish: "Sister, your smile lights up. Wishing you a warm holiday with laughter and love." },
            { id: 82, recipient: 'Sister', wish: "Thank you, Sister, for everything. May your Christmas be as kind and bright as you." },
            { id: 83, recipient: 'Sister', wish: "Sister, you're my rock. Wishing you a holiday full of happiness and magic." },
            { id: 84, recipient: 'Sister', wish: "To Sister, who shares dreams: May this Christmas shower you with love and peace." },
            { id: 85, recipient: 'Sister', wish: "Sister, your love endures. Wishing you a merry Christmas with warmth." },
            { id: 86, recipient: 'Sister', wish: "Dearest Sister, thanks for it all. May your Christmas be magical and joyful." },
        
            // New wishes for Friend
            { id: 87, recipient: 'Friend', wish: "Friend, you're like family. Wishing you a Christmas full of joy, laughs, and great company." },
            { id: 88, recipient: 'Friend', wish: "To my dear Friend: May this holiday bring you happiness, adventure, and festive cheer." },
            { id: 89, recipient: 'Friend', wish: "Friend, thanks for the support. Wishing you a merry Christmas with warmth and fun." },
            { id: 90, recipient: 'Friend', wish: "Dearest Friend, you're amazing. May your Christmas be as loyal and kind as you." },
            { id: 91, recipient: 'Friend', wish: "Friend, your vibes are the best. Wishing you a season of peace, laughs, and good times." },
            { id: 92, recipient: 'Friend', wish: "To my Friend: This Christmas, may you have epic moments and holiday magic." },
            { id: 93, recipient: 'Friend', wish: "Friend, you're irreplaceable. Wishing you a festive Christmas with joy and warmth." },
            { id: 94, recipient: 'Friend', wish: "Thank you, Friend, for everything. May your holiday be bright and full of cheer." },
            { id: 95, recipient: 'Friend', wish: "Friend, you're the greatest. Wishing you a Christmas that's as fun and true as our bond." },
            { id: 96, recipient: 'Friend', wish: "To Friend, with gratitude: May this Christmas wrap you in happiness and surprises." },
            { id: 97, recipient: 'Friend', wish: "Friend, your loyalty shines. Wishing you a peaceful Christmas with laughs and love." },
            { id: 98, recipient: 'Friend', wish: "Dearest Friend, thank you always. May your holiday be merry and bright." },
            { id: 99, recipient: 'Friend', wish: "Friend, you're a true gem. Wishing you a Christmas of joy and great memories." },
            { id: 100, recipient: 'Friend', wish: "To the best Friend: May this Christmas bring you serenity and fun times." },
            { id: 101, recipient: 'Friend', wish: "Friend, your energy uplifts. Wishing you a warm holiday with laughter and cheer." },
            { id: 102, recipient: 'Friend', wish: "Thank you, Friend, for being there. May your Christmas be as kind as you." },
            { id: 103, recipient: 'Friend', wish: "Friend, you're my go-to. Wishing you a holiday full of happiness and adventure." },
            { id: 104, recipient: 'Friend', wish: "To Friend, who shares it all: May this Christmas shower you with love and joy." },
            { id: 105, recipient: 'Friend', wish: "Friend, your friendship endures. Wishing you a merry Christmas with warmth." },
            { id: 106, recipient: 'Friend', wish: "Dearest Friend, thanks for the laughs. May your Christmas be magical and bright." },
        
            // New wishes for Grandparents
            { id: 107, recipient: 'Grandparents', wish: "Grandparents, your stories warm our hearts. Wishing you a Christmas full of peace, love, and family joy." },
            { id: 108, recipient: 'Grandparents', wish: "To my beloved Grandparents: May this holiday bring you health, happiness, and cozy moments." },
            { id: 109, recipient: 'Grandparents', wish: "Grandparents, thanks for the wisdom. Wishing you a merry Christmas with warmth and cherished times." },
            { id: 110, recipient: 'Grandparents', wish: "Dearest Grandparents, you're treasures. May your Christmas be as gentle and loving as you." },
            { id: 111, recipient: 'Grandparents', wish: "Grandparents, your legacy inspires. Wishing you a season of serenity, laughs, and good health." },
            { id: 112, recipient: 'Grandparents', wish: "To my Grandparents: This Christmas, may you feel the magic and family warmth." },
            { id: 113, recipient: 'Grandparents', wish: "Grandparents, you're timeless. Wishing you a festive Christmas with joy and peace." },
            { id: 114, recipient: 'Grandparents', wish: "Thank you, Grandparents, for everything. May your holiday be bright and full of love." },
            { id: 115, recipient: 'Grandparents', wish: "Grandparents, you're the roots. Wishing you a Christmas that's as wise and kind as you." },
            { id: 116, recipient: 'Grandparents', wish: "To Grandparents, with love: May this Christmas wrap you in happiness and health." },
            { id: 117, recipient: 'Grandparents', wish: "Grandparents, your care endures. Wishing you a peaceful Christmas with family and joy." },
            { id: 118, recipient: 'Grandparents', wish: "Dearest Grandparents, thank you always. May your holiday be merry and warm." },
            { id: 119, recipient: 'Grandparents', wish: "Grandparents, you're our foundation. Wishing you a Christmas of serenity and memories." },
            { id: 120, recipient: 'Grandparents', wish: "To the greatest Grandparents: May this Christmas bring you rest and joyful times." },
            { id: 121, recipient: 'Grandparents', wish: "Grandparents, your hugs comfort. Wishing you a warm holiday with love and peace." },
            { id: 122, recipient: 'Grandparents', wish: "Thank you, Grandparents, for the lessons. May your Christmas be as kind as you." },
            { id: 123, recipient: 'Grandparents', wish: "Grandparents, you're inspirations. Wishing you a holiday full of happiness and health." },
            { id: 124, recipient: 'Grandparents', wish: "To Grandparents, who share history: May this Christmas shower you with love and joy." },
            { id: 125, recipient: 'Grandparents', wish: "Grandparents, your bond is strong. Wishing you a merry Christmas with warmth." },
            { id: 126, recipient: 'Grandparents', wish: "Dearest Grandparents, thanks for all. May your Christmas be magical and bright." }
        ];
        const discountCategories = ['Furniture', 'Gaming', 'Musical Instruments', 'Kitchenware', 'Fitness', 'Travel'];
        const mockDiscountItems = [
            { id: 1, name: 'Pro Gaming Keyboard', category: 'Gaming', discount: '50% OFF', price: '$199', original: '$399', image: 'https://placehold.co/400x300/1c1c1c/f8f8f8?text=Keyboard' },
            { id: 2, name: 'Scandinavian Sofa', category: 'Furniture', discount: '40% OFF', price: '$1,200', original: '$2,000', image: 'https://placehold.co/400x300/8c8c8c/f8f8f8?text=Sofa' },
            { id: 3, name: 'Acoustic Guitar Bundle', category: 'Musical Instruments', discount: '35% OFF', price: '$325', original: '$500', image: 'https://placehold.co/400x300/b87d4b/f8f8f8?text=Guitar' },
            { id: 4, name: 'Smart Blender System', category: 'Kitchenware', discount: '30% OFF', price: '$700', original: '$1,000', image: 'https://placehold.co/400x300/e9d5ff/333?text=Blender' },
        ];
        const allIngredients = [
            'Flour', 'Sugar', 'Butter', 'Eggs', 'Milk', 'Chocolate', 'Cinnamon',
            'Ginger', 'Potatoes', 'Turkey', 'Cranberries', 'Wine', 'Nuts', 'Vanilla', 'Cheese', 'Bacon'
        ];

        let currentPage = 'home';
        let activeGiftFilter = 'All';
        let activeWishFilter = 'All';
        let activeDiscountFilter = 'All';
        let selectedIngredients = [];

        // --- BUBBLE GENERATION LOGIC ---
        const createBubbles = () => {
            const wrapper = document.getElementById('bubble-wrapper');
            const numberOfBubbles = 15;

            for (let i = 0; i < numberOfBubbles; i++) {
                const bubble = document.createElement('div');
                bubble.className = 'bubble';

                // Random size (30px to 120px)
                const size = Math.random() * 90 + 30;
                bubble.style.width = `${size}px`;
                bubble.style.height = `${size}px`;

                // Random horizontal position (0% to 100% width)
                bubble.style.left = `${Math.random() * 100}vw`;

                // Random animation duration (10s to 20s) and delay
                const duration = Math.random() * 10 + 10;
                const delay = Math.random() * 5;

                // Apply animation with slight horizontal movement (alternate direction)
                const translateX = (Math.random() < 0.5 ? -1 : 1) * (Math.random() * 50); // +/- 50px

                bubble.style.animation = `
                    bubble-rise ${duration}s ease-in-out ${delay}s infinite alternate
                `;

                // Re-apply random left offset after animation starts to ensure variety
                bubble.style.transform = `translateX(${translateX}px)`;
                
                wrapper.appendChild(bubble);
            }
        };


        // --- NAVIGATION AND UI STATE MANAGEMENT ---

        document.addEventListener('DOMContentLoaded', () => {
            // Initialize lucide icons
            lucide.createIcons();
            // Start the fresh bubble animation
            createBubbles();
            // Initial render
            renderPage(currentPage);

            // Mobile menu toggle
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenuButton.addEventListener('click', () => {
                const icon = mobileMenuButton.querySelector('i');
                mobileMenu.classList.toggle('hidden');
                if (mobileMenu.classList.contains('hidden')) {
                    icon.setAttribute('data-lucide', 'menu');
                } else {
                    icon.setAttribute('data-lucide', 'x');
                }
                lucide.createIcons();
            });
        });

        // Main navigation function
        window.navigate = (page) => {
            if (currentPage === page) return;
            currentPage = page;

            // Update active link styles
            document.querySelectorAll('.nav-link, .mobile-nav-link').forEach(link => {
                link.classList.remove('active-link', 'text-[var(--primary)]', 'font-bold', 'hover:bg-gray-50');
                if (link.getAttribute('data-page') === page) {
                    link.classList.add('active-link', 'text-[var(--primary)]', 'font-bold', 'bg-gray-50');
                }
            });

            // Hide mobile menu on navigation
            const mobileMenu = document.getElementById('mobile-menu');
            if (!mobileMenu.classList.contains('hidden')) {
                document.getElementById('mobile-menu-button').click();
            }

            renderPage(page);
        };

        // --- SECTION RENDERING FUNCTIONS ---

        const renderPage = (page) => {
            const container = document.getElementById('content-container');
            container.innerHTML = ''; // Clear existing content
            const contentDiv = document.createElement('div');
            contentDiv.className = 'page-content'; // Apply fade-in animation

            switch (page) {
                case 'home':
                    contentDiv.innerHTML = renderHomePage();
                    break;
                case 'gifts':
                    contentDiv.innerHTML = renderGiftsPage();
                    setTimeout(() => initGiftListeners(), 0);
                    break;
                case 'wishes':
                    contentDiv.innerHTML = renderWishesPage();
                    setTimeout(() => initWishListeners(), 0);
                    break;
                case 'recipes':
                    contentDiv.innerHTML = renderRecipesPage();
                    setTimeout(() => initRecipeListeners(), 0);
                    break;
                case 'discounts':
                    contentDiv.innerHTML = renderDiscountsPage();
                    setTimeout(() => initDiscountListeners(), 0);
                    break;
                default:
                    contentDiv.innerHTML = renderNotFoundPage();
            }

            container.appendChild(contentDiv);
            lucide.createIcons();
        };

        // --- PAGE CONTENT TEMPLATES ---

        const renderSectionTitle = (title, subtitle) => `
            <div class="mb-12 text-center lg:text-left">
                <h1 class="text-4xl sm:text-5xl lg:text-6xl font-extrabold text-gray-900 tracking-tighter">${title}</h1>
                <p class="mt-4 text-xl text-gray-500 max-w-3xl mx-auto lg:mx-0">${subtitle}</p>
            </div>
        `;

        const renderHomePage = () => `
            <div class="text-center py-16">
                <div class="bg-red-500/10 p-6 rounded-3xl mb-8 inline-block">
                    <i data-lucide="home" class="w-12 h-12 text-[var(--primary)]"></i>
                </div>
                ${renderSectionTitle('Welcome to the Ultimate Christmas Hub.', 'Discover curated gifts, heartfelt wishes, holiday recipes, and the best deals of the season.')}

                <div class="grid md:grid-cols-2 gap-8 mt-12">
                    <!-- Feature 1: Gifting -->
                    <div class="apple-card p-6 md:p-10 rounded-3xl text-left bg-gradient-to-br from-white to-red-50">
                        <i data-lucide="gift" class="w-8 h-8 text-[var(--primary)] mb-4"></i>
                        <h3 class="text-2xl font-semibold mb-2">Curated Gift Market</h3>
                        <p class="text-gray-600 mb-4">Browse our top 20 affiliate picks, categorized by shoes, tech, decor, and more. Find the perfect present easily.</p>
                        <a onclick="navigate('gifts')" class="text-[var(--primary)] font-medium inline-flex items-center hover:underline cursor-pointer">
                            Explore Gifts <i data-lucide="chevron-right" class="w-4 h-4 ml-1"></i>
                        </a>
                    </div>
                    <!-- Feature 2: Recipes -->
                    <div class="apple-card p-6 md:p-10 rounded-3xl text-left bg-gradient-to-br from-white to-green-50">
                        <i data-lucide="utensils" class="w-8 h-8 text-[var(--secondary)] mb-4"></i>
                        <h3 class="text-2xl font-semibold mb-2">The Christmas Kitchen</h3>
                        <p class="text-gray-600 mb-4">Search for recipes based on ingredients you already have, powered by real-time Google Search data.</p>
                        <a onclick="navigate('recipes')" class="text-[var(--secondary)] font-medium inline-flex items-center hover:underline cursor-pointer">
                            Start Cooking <i data-lucide="chevron-right" class="w-4 h-4 ml-1"></i>
                        </a>
                    </div>
                </div>
                <p class="mt-12 text-lg text-gray-700">Explore the tabs above to dive into the full experience.</p>
            </div>
        `;

        // --- GIFTS PAGE LOGIC AND TEMPLATE ---

        const renderGiftCard = (gift) => `
            <div class="apple-card p-4 rounded-xl flex flex-col h-full hover:scale-[1.02]">
                <img src="${gift.image}" alt="${gift.name}" class="rounded-lg mb-4 object-cover w-full h-40">
                <div class="flex-grow">
                    <span class="text-xs font-medium text-gray-500 uppercase">${gift.category}</span>
                    <h3 class="text-xl font-semibold text-gray-900 mt-1 mb-2">${gift.name}</h3>
                    <p class="text-gray-500 text-sm mb-3">${gift.description}</p>
                </div>
                <div class="mt-4 pt-4 border-t border-gray-100 flex justify-between items-center">
                    <span class="text-xl font-bold text-[var(--primary)]">${gift.price}</span>
                    <a href="${gift.link}" target="_blank" rel="noopener noreferrer" class="bg-gray-900 text-white text-sm font-medium py-2 px-4 rounded-full hover:bg-gray-700 transition-colors inline-flex items-center">
                        Buy Now <i data-lucide="external-link" class="w-4 h-4 ml-2"></i>
                    </a>
                </div>
            </div>
        `;

        const renderGiftsPage = () => `
            ${renderSectionTitle('The Ultimate Gift Guide', 'Top 20 curated Christmas gifts with affiliate links, filterable by category.')}

            <div class="mb-8 overflow-x-auto whitespace-nowrap py-2 flex space-x-3">
                <button onclick="filterGifts('All')" class="filter-btn text-sm font-medium py-2 px-4 rounded-full transition-all ${activeGiftFilter === 'All' ? 'bg-gray-900 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}" data-filter="All">All</button>
                ${giftCategories.map(cat => `
                    <button onclick="filterGifts('${cat}')" class="filter-btn text-sm font-medium py-2 px-4 rounded-full transition-all ${activeGiftFilter === cat ? 'bg-gray-900 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}" data-filter="${cat}">
                        ${cat}
                    </button>
                `).join('')}
            </div>

            <div id="gift-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
                <!-- Gift cards will be injected here -->
            </div>
            <div class="text-center mt-12 text-gray-500">
                <p>Showing 8 of 20+ Gifts. Affiliate links help support this site.</p>
            </div>
        `;

        window.filterGifts = (category) => {
            activeGiftFilter = category;
            const list = document.getElementById('gift-list');
            list.classList.remove('page-content'); // Disable animation for filtering
            list.innerHTML = ''; // Clear content

            // Update button styles
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('bg-gray-900', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
                if (btn.getAttribute('data-filter') === category) {
                    btn.classList.add('bg-gray-900', 'text-white');
                    btn.classList.remove('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
                }
            });

            const filteredGifts = category === 'All'
                ? mockGifts
                : mockGifts.filter(g => g.category === category);

            filteredGifts.forEach(gift => {
                list.innerHTML += renderGiftCard(gift);
            });
            lucide.createIcons();
            // Re-enable animation for filtered results (optional, but nice)
            list.classList.add('page-content');
        };

        const initGiftListeners = () => {
             // Initial load of all gifts
             filterGifts(activeGiftFilter);
        };

        // --- WISHES PAGE LOGIC AND TEMPLATE ---

        const renderWishCard = (wishItem) => `
            <div class="apple-card p-6 rounded-xl flex flex-col justify-between hover:scale-[1.01] bg-white">
                <div class="mb-4">
                    <h3 class="text-2xl font-bold text-[var(--primary)] mb-2">${wishItem.recipient}</h3>
                    <p class="text-gray-700 text-lg">${wishItem.wish}</p>
                </div>
                <button onclick="copyToClipboard('${wishItem.wish.replace(/'/g, "\\'")}')" class="text-sm font-medium text-gray-500 hover:text-gray-900 transition-colors self-end mt-4 flex items-center">
                    Copy Wish <i data-lucide="copy" class="w-4 h-4 ml-2"></i>
                </button>
            </div>
        `;

        const renderWishesPage = () => {
            const recipients = ['All', ...new Set(mockWishes.map(w => w.recipient))];
            return `
                ${renderSectionTitle('The Perfect Christmas Wish', 'Heartfelt messages for everyone on your list: family, friends, and loved ones.')}

                <div class="mb-8 overflow-x-auto whitespace-nowrap py-2 flex space-x-3">
                    ${recipients.map(rec => `
                        <button onclick="filterWishes('${rec}')" class="wish-filter-btn text-sm font-medium py-2 px-4 rounded-full transition-all ${activeWishFilter === rec ? 'bg-gray-900 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}" data-filter="${rec}">
                            For ${rec}
                        </button>
                    `).join('')}
                </div>

                <div id="wish-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- Wish cards will be injected here -->
                </div>
            `;
        };

        window.filterWishes = (recipient) => {
            activeWishFilter = recipient;
            const list = document.getElementById('wish-list');
            list.classList.remove('page-content');
            list.innerHTML = '';

            // Update button styles
            document.querySelectorAll('.wish-filter-btn').forEach(btn => {
                btn.classList.remove('bg-gray-900', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
                if (btn.getAttribute('data-filter') === recipient) {
                    btn.classList.add('bg-gray-900', 'text-white');
                    btn.classList.remove('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
                }
            });

            const filteredWishes = recipient === 'All'
                ? mockWishes
                : mockWishes.filter(w => w.recipient === recipient);

            filteredWishes.forEach(item => {
                list.innerHTML += renderWishCard(item);
            });
            lucide.createIcons();
            list.classList.add('page-content');
        };

        window.copyToClipboard = (text) => {
            try {
                // Use document.execCommand('copy') for better compatibility in iFrames
                const tempInput = document.createElement('textarea');
                tempInput.value = text;
                document.body.appendChild(tempInput);
                tempInput.select();
                document.execCommand('copy');
                document.body.removeChild(tempInput);
                // Simple feedback message
                showSystemMessage('Wish copied to clipboard!');
            } catch (err) {
                console.error('Failed to copy text: ', err);
                showSystemMessage('Failed to copy wish.', true);
            }
        };

        const initWishListeners = () => {
            filterWishes(activeWishFilter);
        };

        // --- RECIPES PAGE LOGIC AND TEMPLATE ---

        const renderRecipeCard = (recipe) => `
            <div class="apple-card p-6 rounded-xl hover:scale-[1.01] bg-white">
                <h3 class="text-xl font-bold text-gray-900 mb-2">${recipe.recipeName}</h3>
                <p class="text-gray-600 text-sm mb-4">${recipe.quickSummary}</p>
                <div class="flex flex-wrap gap-2">
                    ${recipe.mainIngredients.map(ing => `
                        <span class="px-3 py-1 bg-red-100 text-[var(--primary)] text-xs font-medium rounded-full">${ing}</span>
                    `).join('')}
                </div>
            </div>
        `;

        const renderRecipesPage = () => `
            ${renderSectionTitle('The Festive Kitchen', 'Find Christmas recipes by searching or checking off ingredients you already have.')}

            <div class="mb-10 p-6 apple-card rounded-2xl">
                <h3 class="text-xl font-semibold mb-4 text-gray-900">What do you have?</h3>
                <div id="ingredient-checkboxes" class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-3 mb-6">
                    ${allIngredients.map(ing => `
                        <div class="flex items-center">
                            <input type="checkbox" id="ing-${ing.toLowerCase()}" name="ingredient" value="${ing}" ${selectedIngredients.includes(ing) ? 'checked' : ''}
                                class="h-4 w-4 text-[var(--primary)] border-gray-300 rounded focus:ring-2 focus:ring-[var(--primary)] ingredient-checkbox"
                            >
                            <label for="ing-${ing.toLowerCase()}" class="ml-2 text-sm font-medium text-gray-700 cursor-pointer select-none">${ing}</label>
                        </div>
                    `).join('')}
                </div>
                <button id="find-recipe-btn" class="w-full sm:w-auto bg-[var(--secondary)] text-white font-semibold py-3 px-6 rounded-full hover:bg-green-700 transition-colors inline-flex items-center justify-center">
                    <i data-lucide="search" class="w-5 h-5 mr-2"></i> Find Recipes
                </button>
            </div>

            <div class="mb-10 p-6 apple-card rounded-2xl">
                <h3 class="text-xl font-semibold mb-4 text-gray-900">...or Search for a Specific Dish</h3>
                <div class="flex flex-col sm:flex-row gap-4">
                    <input type="text" id="recipe-search-input" placeholder="e.g., Roast Turkey with Cranberry Sauce"
                        class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[var(--primary)] focus:border-[var(--primary)] transition-shadow"
                    >
                    <button id="search-recipe-btn" class="sm:w-auto bg-gray-900 text-white font-semibold py-3 px-6 rounded-full hover:bg-gray-700 transition-colors inline-flex items-center justify-center">
                        <i data-lucide="search" class="w-5 h-5 mr-2"></i> Search
                    </button>
                </div>
            </div>

            <div id="recipe-results-area">
                <h2 class="text-3xl font-bold mb-6 text-gray-900">Dishes to Make</h2>
                <div id="recipe-list" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <p id="recipe-placeholder" class="col-span-full text-center text-gray-500 p-8 border border-dashed rounded-xl">
                        Search for a dish or check ingredients above to find your perfect Christmas recipe!
                    </p>
                    <!-- Recipes will be injected here -->
                </div>
                <div id="recipe-sources" class="mt-8 text-sm text-gray-500 hidden">
                    <p class="font-semibold">Sources:</p>
                    <!-- Sources will be injected here -->
                </div>
            </div>
        `;

        window.fetchRecipes = async (queryType) => {
            const list = document.getElementById('recipe-list');
            const placeholder = document.getElementById('recipe-placeholder');
            const findBtn = document.getElementById('find-recipe-btn');
            const searchBtn = document.getElementById('search-recipe-btn');
            const sourcesDiv = document.getElementById('recipe-sources');
            const searchInput = document.getElementById('recipe-search-input');

            list.innerHTML = '';
            sourcesDiv.classList.add('hidden');

            let userQuery = '';
            let systemPrompt = '';

            if (queryType === 'ingredients') {
                if (selectedIngredients.length === 0) {
                    showSystemMessage('Please select at least one ingredient.', true);
                    return;
                }
                userQuery = `Based on the following ingredients: ${selectedIngredients.join(', ')}. What are three traditional Christmas dishes I can make? Focus on savory and sweet festive items.`;
                systemPrompt = 'Act as a top-tier culinary expert. Provide a list of 3-5 distinct, traditional Christmas recipes suitable for a home chef based on the user\'s available ingredients. Your output must strictly follow the JSON schema provided.';
            } else if (queryType === 'search') {
                const searchQ = searchInput.value.trim();
                if (!searchQ) {
                    showSystemMessage('Please enter a search term for the recipe.', true);
                    return;
                }
                userQuery = `Find traditional Christmas recipes related to "${searchQ}". Give 3-5 recipes.`;
                systemPrompt = 'Act as a professional chef. Provide a list of 3-5 distinct Christmas recipes based on the user\'s query. Your output must strictly follow the JSON schema provided.';
            }

            // Show loading state
            const loadingHtml = `<div class="col-span-full text-center p-8 flex flex-col items-center justify-center">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-[var(--primary)] mb-4"></div>
                <p class="text-gray-600">Searching the web for festive recipes...</p>
            </div>`;
            list.innerHTML = loadingHtml;
            placeholder.style.display = 'none';

            // Disable buttons
            findBtn.disabled = true;
            searchBtn.disabled = true;
            findBtn.innerHTML = '<div class="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>';
            searchBtn.innerHTML = '<div class="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>';

            const recipeSchema = {
                type: "ARRAY",
                items: {
                    type: "OBJECT",
                    properties: {
                        "recipeName": { "type": "STRING", "description": "The name of the Christmas recipe." },
                        "mainIngredients": { "type": "ARRAY", "items": { "type": "STRING" }, "description": "A brief list of 3-5 key ingredients." },
                        "quickSummary": { "type": "STRING", "description": "A very short, one-sentence summary of the dish." }
                    },
                    required: ["recipeName", "mainIngredients", "quickSummary"]
                }
            };

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                tools: [{ "google_search": {} }], // Enable Google Search grounding
                systemInstruction: { parts: [{ text: systemPrompt }] },
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: recipeSchema
                }
            };

            try {
                const response = await fetch(GEMINI_API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                const result = await response.json();
                const candidate = result.candidates?.[0];

                if (!candidate || !candidate.content?.parts?.[0]?.text) {
                     list.innerHTML = `<p class="col-span-full text-center text-red-500 p-8">Could not find any recipes. Please try a different query.</p>`;
                     return;
                }

                // --- 1. Process Text/JSON ---
                const jsonText = candidate.content.parts[0].text;
                let recipes;
                try {
                    recipes = JSON.parse(jsonText);
                } catch (e) {
                    console.error("Failed to parse JSON response:", jsonText, e);
                    list.innerHTML = `<p class="col-span-full text-center text-red-500 p-8">Error processing recipe data. Received unstructured data.</p>`;
                    return;
                }

                list.innerHTML = recipes.map(renderRecipeCard).join('');
                if (recipes.length === 0) {
                    list.innerHTML = `<p class="col-span-full text-center text-gray-500 p-8">No recipes found for your selection.</p>`;
                }


                // --- 2. Process Sources ---
                let sources = [];
                const groundingMetadata = candidate.groundingMetadata;
                if (groundingMetadata && groundingMetadata.groundingAttributions) {
                    sources = groundingMetadata.groundingAttributions
                        .map(attribution => ({
                            uri: attribution.web?.uri,
                            title: attribution.web?.title,
                        }))
                        .filter(source => source.uri && source.title);
                }

                if (sources.length > 0) {
                    sourcesDiv.innerHTML = `<p class="font-semibold mb-2">Sources used:</p>` +
                        sources.map(s => `<a href="${s.uri}" target="_blank" class="block text-blue-600 hover:text-blue-800 hover:underline transition-colors">${s.title}</a>`).join('');
                    sourcesDiv.classList.remove('hidden');
                } else {
                    sourcesDiv.classList.add('hidden');
                }

            } catch (error) {
                console.error("API Call Error:", error);
                list.innerHTML = `<p class="col-span-full text-center text-red-500 p-8">An error occurred while fetching recipes: ${error.message}</p>`;
            } finally {
                // Restore button state
                findBtn.disabled = false;
                searchBtn.disabled = false;
                findBtn.innerHTML = '<i data-lucide="search" class="w-5 h-5 mr-2"></i> Find Recipes';
                searchBtn.innerHTML = '<i data-lucide="search" class="w-5 h-5 mr-2"></i> Search';
                lucide.createIcons(); // Re-render icons after state change
            }
        };

        const initRecipeListeners = () => {
            const list = document.getElementById('recipe-list');
            list.innerHTML = '';
            document.getElementById('recipe-placeholder').style.display = 'block';

            // Event listener for ingredient checkboxes
            document.querySelectorAll('.ingredient-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', (e) => {
                    const value = e.target.value;
                    if (e.target.checked) {
                        if (!selectedIngredients.includes(value)) {
                            selectedIngredients.push(value);
                        }
                    } else {
                        selectedIngredients = selectedIngredients.filter(ing => ing !== value);
                    }
                });
            });

            // Event listener for 'Find Recipes' button
            document.getElementById('find-recipe-btn').addEventListener('click', () => fetchRecipes('ingredients'));

            // Event listener for 'Search' button
            document.getElementById('search-recipe-btn').addEventListener('click', () => fetchRecipes('search'));

            // Pre-check any previously selected ingredients
            document.querySelectorAll('.ingredient-checkbox').forEach(checkbox => {
                if (selectedIngredients.includes(checkbox.value)) {
                    checkbox.checked = true;
                }
            });
        };


        // --- DISCOUNTS PAGE LOGIC AND TEMPLATE ---

        const renderDiscountCard = (item) => `
            <div class="apple-card p-6 rounded-xl flex flex-col h-full hover:scale-[1.02] bg-white">
                <img src="${item.image}" alt="${item.name}" class="rounded-lg mb-4 object-cover w-full h-40">
                <div class="flex-grow">
                    <span class="text-sm font-semibold text-gray-500 uppercase">${item.category}</span>
                    <h3 class="text-xl font-bold text-gray-900 mt-1 mb-2">${item.name}</h3>
                    <p class="text-4xl font-extrabold text-[var(--primary)] mb-1">${item.discount}</p>
                </div>
                <div class="mt-4 pt-4 border-t border-gray-100 flex justify-between items-center">
                    <div>
                        <span class="text-lg font-bold text-gray-900">${item.price}</span>
                        <span class="text-sm text-gray-400 line-through ml-2">${item.original}</span>
                    </div>
                    <button class="bg-gray-900 text-white text-sm font-medium py-2 px-4 rounded-full hover:bg-gray-700 transition-colors">
                        View Deal
                    </button>
                </div>
            </div>
        `;

        const renderDiscountsPage = () => {
            const categories = ['All', ...discountCategories];
            return `
                ${renderSectionTitle('Discountable Value Finds', 'High-value items across furniture, gaming, and musical categories with deep Christmas discounts.')}

                <div class="mb-8 overflow-x-auto whitespace-nowrap py-2 flex space-x-3">
                    ${categories.map(cat => `
                        <button onclick="filterDiscounts('${cat}')" class="discount-filter-btn text-sm font-medium py-2 px-4 rounded-full transition-all ${activeDiscountFilter === cat ? 'bg-gray-900 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}" data-filter="${cat}">
                            ${cat}
                        </button>
                    `).join('')}
                </div>

                <div id="discount-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
                    <!-- Discount items will be injected here -->
                </div>
                <div class="text-center mt-12 text-gray-500">
                    <p>Prices and discounts are indicative and subject to change by retailers.</p>
                </div>
            `;
        };

        window.filterDiscounts = (category) => {
            activeDiscountFilter = category;
            const list = document.getElementById('discount-list');
            list.classList.remove('page-content');
            list.innerHTML = '';

            // Update button styles
            document.querySelectorAll('.discount-filter-btn').forEach(btn => {
                btn.classList.remove('bg-gray-900', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
                if (btn.getAttribute('data-filter') === category) {
                    btn.classList.add('bg-gray-900', 'text-white');
                    btn.classList.remove('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
                }
            });

            const filteredItems = category === 'All'
                ? mockDiscountItems
                : mockDiscountItems.filter(i => i.category === category);

            filteredItems.forEach(item => {
                list.innerHTML += renderDiscountCard(item);
            });
            lucide.createIcons();
            list.classList.add('page-content');
        };

        const initDiscountListeners = () => {
             filterDiscounts(activeDiscountFilter);
        };

        // --- GLOBAL UI UTILITIES ---

        // Simple custom message box (replacement for alert())
        const showSystemMessage = (message, isError = false) => {
            let messageBox = document.getElementById('system-message-box');
            if (!messageBox) {
                messageBox = document.createElement('div');
                messageBox.id = 'system-message-box';
                messageBox.className = 'fixed top-4 right-4 z-[100] p-4 rounded-xl shadow-2xl transition-transform duration-300 ease-in-out transform translate-x-full';
                document.body.appendChild(messageBox);
            }

            messageBox.textContent = message;
            messageBox.className = 'fixed top-4 right-4 z-[100] p-4 rounded-xl shadow-2xl transition-transform duration-300 ease-in-out transform';

            if (isError) {
                messageBox.classList.add('bg-red-600', 'text-white');
            } else {
                messageBox.classList.add('bg-gray-900', 'text-white');
            }

            // Slide in
            setTimeout(() => {
                messageBox.style.transform = 'translateX(0)';
            }, 10);

            // Slide out after 3 seconds
            setTimeout(() => {
                messageBox.style.transform = 'translateX(100%)';
            }, 3000);
        };

    </script>
</body>
</html>
